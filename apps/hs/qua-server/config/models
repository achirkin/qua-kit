-- | Web-app user (authorize via ETHZ LDAP or EdX LTI or pre-defined).
User
    name Text
    role UserRole default=0
    ethUserName Text Maybe
    edxUserId Text Maybe
    email Text Maybe
    password Text Maybe -- Password may not be set yet
    verified Bool default=false
    ETHUserName ethUserName !force
    EdxUserId edxUserId !force
    UserEmailId email !force
    deriving Show

-- | Additional user properties
UserProp
    userId UserId
    key    Text
    value  Text
    UserProperty userId key
    deriving Show

-- | Normally a course unit
EdxResource
    linkId       Text
    courseId     EdxCourseId
    friendlyName Text Maybe
    EdxResLinkId linkId courseId
    deriving Show

-- | custom parameters set for an exercise
EdxResourceParam
    resourceId  EdxResourceId
    key         Text
    value       Text
    EdxResParam resourceId key
    deriving Show

-- | An edX course
EdxCourse
    contextId    Text
    friendlyName Text Maybe
    EdxContextId contextId
    deriving Show

ScenarioProblem
    image            ByteString
    geometry         ByteString
    description      Text
    scale            Double
    invitationSecret Text
    deriving Show
    deriving Eq
    deriving Ord

Scenario
    authorId      UserId
    taskId        ScenarioProblemId
    image         ByteString
    geometry      ByteString
    description   Text
    scale         Double
    edxResource   EdxResourceId
    edxOutcomeUrl Text Maybe
    edxResultId   Text Maybe
    lastUpdate    UTCTime default=CURRENT_TIMESTAMP

CurrentScenario
    historyScenarioId ScenarioId
    authorId      UserId
    taskId        ScenarioProblemId
    description   Text
    edxResource   EdxResourceId
    edxOutcomeUrl Text Maybe
    edxResultId   Text Maybe
    grade         Double Maybe
    lastUpdate    UTCTime default=CURRENT_TIMESTAMP
    SubmissionOf authorId taskId
    HistoryScenarioId historyScenarioId

Review
    reviewerId  UserId
    scenarioId  ScenarioId
    criterionId CriterionId
    positive    Bool
    comment     Text
    timestamp   UTCTime default=CURRENT_TIMESTAMP
    ReviewOf reviewerId scenarioId criterionId

ExpertReview
    reviewerId  UserId
    scenarioId  ScenarioId
    comment     Text
    grade       Int
    timestamp   UTCTime default=CURRENT_TIMESTAMP
    ExpertReviewOf reviewerId scenarioId

Criterion
    name         Text
    description  Text
    image        ByteString
    icon         Text
    CriterionDef name

ProblemCriterion
    problemId ScenarioProblemId
    criterionId CriterionId
    ProblemCriterionUnique problemId criterionId

Vote
    voterId       UserId
    criterionId   CriterionId
    betterId      ScenarioId
    worseId       ScenarioId
    explanation   Text Maybe
    edxResource   EdxResourceId Maybe
    edxOutcomeUrl Text Maybe
    edxResultId   Text Maybe
    timestamp     UTCTime default=CURRENT_TIMESTAMP

VoteGrade
    studentId     UserId
    edxResource   EdxResourceId
    edxOutcomeUrl Text
    edxResultId   Text
    grade         Double
    GradeFor studentId edxResource edxOutcomeUrl edxResultId
    deriving Eq
    deriving Ord
    deriving Show

Rating
    problemId   ScenarioProblemId
    criterionId CriterionId
    authorId    UserId
    value       Double
    RatingOf authorId problemId criterionId
    deriving Eq
    deriving Ord
    deriving Show

Feedback
    authorId    UserId Maybe
    text        Text

UserScenarioLoad
    authorId     UserId Maybe
    scenarioId   ScenarioProblemId Maybe
    timestamp    UTCTime default=CURRENT_TIMESTAMP
    geometry     Text
    scale        Double

UserScenarioUpdate
    loaded       UserScenarioLoadId
    timestamp    UTCTime default=CURRENT_TIMESTAMP
    geometry     Text

UserScenarioAction
    loaded       UserScenarioLoadId
    timestamp    UTCTime default=CURRENT_TIMESTAMP
    geomId       Int
    x11 Double
    x12 Double
    x13 Double
    x14 Double
    x21 Double
    x22 Double
    x23 Double
    x24 Double
    x31 Double
    x32 Double
    x33 Double
    x34 Double
    x41 Double
    x42 Double
    x43 Double
    x44 Double

Survey
    userId   UserId Maybe
    question Text
    answer   Text
    deriving Show
